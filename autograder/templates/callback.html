<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>OAuth Callback</title>
</head>
<body>
	<script>
		// Parse the URL fragment to extract tokens and other information
		const fragment = new URLSearchParams(window.location.hash.substring(1));
		const accessToken = fragment.get("access_token");
		const expiresAt = fragment.get("expires_at");
		const expiresIn = fragment.get("expires_in");
		const providerToken = fragment.get("provider_token");
		const refreshToken = fragment.get("refresh_token");
		const tokenType = fragment.get("token_type");

		if (accessToken) {
			// Determine the protocol and host dynamically
			const protocol = window.location.protocol;
			const host = window.location.host;
			const storeTokenUrl =
				host === "localhost" ? `http://${host}/store_token` : `https://${host}/store_token`;
			console.log(protocol);
			console.log(storeTokenUrl);

			// Send the tokens and other information to the server
			fetch(storeTokenUrl, {
				method: "POST",
				headers: {
					"Content-Type": "application/x-www-form-urlencoded",
				},
				body: new URLSearchParams({
					access_token: accessToken,
					expires_at: expiresAt,
					expires_in: expiresIn,
					provider_token: providerToken,
					refresh_token: refreshToken,
					token_type: tokenType,
				}),
			})
				.then((response) => response.json())
				.then((data) => {
					console.log("Success:", data);
				})
				.catch((error) => {
					console.error("Error:", error);
				});
		}
	</script>
</body>
